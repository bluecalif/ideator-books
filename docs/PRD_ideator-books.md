# PRD v1 (MVP 중심) → v2(고도화) 로드맵: 전문가 KB 기반 1p 생성 서비스

## 0. 목표
- **MVP**: 사용자가 CSV(80~90권)에서 도서를 선택하고, **1p 결과물(콘텐츠/서비스)**을 안정적으로 생성·저장·재활용한다.  
- **v2**: 검토/승인 다단계, 고급 융합, 히스토리×리마인드 시각화, 팀 협업까지 확장.

---

## 1. 사용자 가치 (MVP 범위)
- 3분 내 **한 건의 1p** 생성(핵심 앵커 기반, 고유문장 3개 포함).
- 결과물은 **히스토리**로 누적, **리마인드 큐**로 재학습.
- **융합 모드**는 간단 선택(추천 1개 + 대안 1개), 샘플 미리보기 제공.

---

## 2. 입력/출력 (명확성)
### 입력
- **CSV 업로드**: `일련번호, Title, 연도, 저자, 구분, Topic, 요약`  
- **도서 선택(필터)**: 날짜(업로드일/연도), 주제(구분/Topic)  
- **옵션**: 결과 형식(콘텐츠/서비스), 융합 모드(추천/대안), 리마인드 on/off

### 출력
- **1p 결과물**(MD/PDF):  
  - 머리말(형식 분기 1줄 사유)  
  - 도메인 리뷰 카드(4) — 문장 단위 `anchored_by`  
  - 통합 기록(긴장축 2~3, 결론 1줄)  
  - 아이디어 2~3  
  - **고유문장 3개**  
- **히스토리 저장** + **리마인드 큐(요약 카드)**

---

## 3. 주요 플로우 (MVP)
1) 로그인 → 2) CSV 업로드/선택 → 3) **도서 선택**(날짜/주제 필터)  
4) **Fusion Helper(라이트)**: 추천 모드 1개 + 대안 1개(샘플 2문장) → 선택  
5) **생성 진행뷰(라이트)**: 파이프라인 바(진행률), 에러 시 재시도  
6) **1p 미리보기**(앵커 뱃지 토글) → **단일 승인**(저장)  
7) 히스토리 카드로 이동(리마인드 on/off 설정)

---

## 4. 화면 & UI (MVP)

### 4.1 라이브러리
- 상단: 업로드된 CSV 리스트(+업로드 버튼)  
- 하단: 최근 결과물 6개 카드(제목/형식/도메인 분포 점 아이콘/생성일)

### 4.2 도서 선택
- 좌측 필터: 날짜(달력), 연도 범위 슬라이더, 구분/Topic 체크  
- 중앙 표: 도서 목록(제목, 저자, 연도, 요약 2줄 미리보기)  
- 우측 선택 패널: 선택 도서 수, 결과 형식(토글), 리마인드 on/off

### 4.3 Fusion Helper(라이트)
- 상단 3줄 요약: 입력 개요, 예상 형식 분기, **추천 융합**(사유 1줄)  
- 카드 2개 비교:  
  - **추천**(예: Reduce): 샘플 2문장  
  - **대안**(예: 단순병합): 샘플 2문장  
- 선택 버튼(둘 중 하나)

### 4.4 생성 진행뷰(라이트)
- 상단 진행 바: `Map(앵커) → Review[4] → Integrate → Produce → Validate`  
- 노드별 상태 점(회색/진행/완료/경고), 실패 시 “재시도”  
- 하단 로그 1줄(요약): anchored_by %, 고유문장 수

### 4.5 미리보기 & 단일 승인
- 좌측: 1p 본문(머리말~고유문장)  
- 우측: **앵커 토글**(문장 끝 [anchor_id] 표시), 다운로드(MD/PDF), 저장  
- **승인 버튼 1개**만 제공(추후 v2에서 단계화)

### 4.6 히스토리 × 리마인드(라이트)
- 카드 목록: 제목/형식/긴장축 키워드/생성일/리마인드 상태  
- 각 카드의 **“복습 카드 미리보기”** 버튼 → 고유문장1 + 텐션축 요약(30초)

---

## 5. 융합 모드 (MVP)
- **추천(기본: Reduce)**  
  - 분야별 요지를 압축 → 공통 **긴장축 2~3개**로 정리 → 결론 1줄  
  - **권장 상황**: 원칙·방법 중심, 안정적 품질 필요
- **대안(단순병합)**  
  - 4도메인 리뷰 병치 + 결론 1줄  
  - **권장 상황**: 빠른 초안, 다수 도서 일괄 처리
> **교차비평**은 v2로 이월(논쟁 중심/심화 시나리오)

---

## 6. LangGraph (MVP 노드 구성)
- **AnchorMapper**: 요약 → 도메인별 상위 앵커 1개 매핑(+합치/상충/누락/경계)  
- **Reviewers_[4]**: 장점·문제·조건을 앵커 문장으로 생성  
- **Integrator(Reduce/단순병합)**: 긴장축 2~3 도출, 형식 분기 1줄 사유  
- **Producer**: 1p(동적 레이아웃)  
- **Validator**: anchored_by=100%, 고유문장≥3, 외부 프레임=0

> **편집/재시도**: MVP에서는 **노드 결과 수동 수정 없음**, 실패 지점 **재실행만** 제공(v2에서 인라인 편집 추가)

---

## 7. 데이터 모델 (MVP 최소)
- **users**(id, email, name, created_at)  
- **libraries**(id, user_id, name, uploaded_at)  
- **books**(id, library_id, meta_json)  
- **kb_items**(kb_id, domain, type, anchor_id, content)  
- **runs**(id, user_id, params_json{book_ids, mode, format}, status, created_at)  
- **artifacts**(id, run_id, kind(onepager), format(md/pdf), url)  
- **reminders**(id, user_id, artifact_id, schedule, active)  
- **audits**(id, run_id, anchored_by_ok, unique3_ok, external0_ok)

---

## 8. API (MVP 간단)
- `POST /upload` — CSV 업로드(라이브러리 생성/갱신)  
- `GET /books?filters` — 도서 조회  
- `POST /runs` — 생성 요청(body: book_ids, mode, format, remind)  
- `GET /runs/{id}` — 상태/진행률  
- `GET /artifacts/{id}` — 1p 다운로드 링크  
- `POST /reminders` — 리마인드 on/off

---

## 9. 가드레일 & KPI (MVP)
- **규칙**: 문장 단위 anchored_by=100%, 고유문장≥3, 외부 프레임=0  
- **KPI**:  
  - 1건 생성 성공률 ≥ 98%  
  - 평균 생성 시간(단일 도서) ≤ 30s  
  - 승인 라운드 = 1(단일 승인)  
  - 복습 카드 클릭률 ≥ 35%

---

## 10. 비기능 (MVP)
- 동시성 30, 업타임 99%, PDF 발행 < 3s, 로그·감사 저장

---

## 11. 로드맵
### v1 (MVP, 4~6주)
- CSV 인입/도서 선택/Reduce·단순병합/단일 승인/히스토리×리마인드(라이트)

### v1.5
- 히스토리 비교(두 결과물 나란히), 콜렉션, 기본 통계(도메인 분포/사용량)

### v2 (고도화)
- **검토/승인 단계화**(형식·앵커 → 텐션축 → 최종)  
- **교차비평 모드** + Fusion Helper(설문/난이도/코스트 안내)  
- **생성 진행뷰(풀 버전)**: 노드 인라인 편집, 가드레일 자동 수정안  
- **지식 재활용 보드**: 타임라인/매트릭스, 추천 복습 큐(관련 결과물 추천)  
- 팀 공유/버전 diff/주석, 권한관리

---

## 12. 수용 기준 (MVP Done)
- CSV 80~90권에서 **3권 선택 → 1p 3건** 생성 성공  
- 각 1p에서 anchored_by 100%, 고유문장 3개 검증 통과  
- 리마인드 큐 생성 및 카드 미리보기 제공  
- 히스토리에 3건 모두 저장 & 재다운로드 가능

---

## 13. 핵심 화면 요약(피그마 가이드)
- **도서 선택**: 3열 레이아웃(필터/목록/옵션)  
- **Fusion Helper(라이트)**: 추천 vs 대안 카드 비교(샘플 2문장)  
- **진행뷰(라이트)**: 수평 진행 바 + 상태 점 + 1줄 로그  
- **미리보기**: 본문/앵커 토글, 단일 승인  
- **히스토리**: 카드 목록 + 복습 카드 미리보기

---
