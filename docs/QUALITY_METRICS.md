# 품질 검증 메트릭

ideator-books MVP의 1p 생성 품질 검증 결과

## 📊 검증 기준

### 1. **anchored_by** (KB 앵커 비율)
- **목표**: 100% (모든 문장이 KB 앵커 포함)
- **측정 방법**: (앵커 있는 문장 / 전체 문장) × 100

### 2. **가짜 앵커**
- **목표**: 0개
- **정의**: KB에 없는 앵커 (예: `긴장축_1`, `통합지식_001`)

### 3. **고유문장**
- **목표**: 3개 이상
- **정의**: "## 고유 문장(3)" 섹션에 명시된 문장

### 4. **구조 완성도**
- **목표**: 12/12 섹션
- **섹션**: 출발 지식, 형식 분기, 도메인 리뷰(4개), 통합 기록, 제안서(제목~CTA)

---

## 📈 Phase별 품질 변화

### Phase 1.5 (2025-11-09) - 백엔드 단독 테스트

**환경**: 백엔드 단독 실행, gpt-4.1-mini 모델

**결과**:
- ✅ **anchored_by**: **70.5%** (18.2% → 3.9배 개선)
- ✅ **가짜 앵커**: **0개** (3개 → 완전 해결)
- ✅ **고유문장**: **3개** (0개 → 정상 추출)
- ✅ **구조**: **12/12 섹션** 완성
- ✅ **앵커 사용**: 33회 (11회 → 3배)
- ✅ **고유 앵커**: 5개 (3개 → 1.7배)

**핵심 개선**:
- KB 통합지식 파싱 및 활용
- Reviewer Structured Output 변경
- Producer 프롬프트 강화 (가짜 앵커 방지)
- 고유문장 추출 regex 수정

---

### Phase 3.3 (2025-11-11) - 프론트엔드 통합 후

**환경**: 프론트엔드 → 백엔드 E2E, gpt-4.1-mini 모델

**초기 문제 (KB 미초기화)**:
- ❌ **anchored_by**: **24.4%** (백엔드 70.5% 대비 3배 하락)
- ❌ **가짜 앵커**: **4개** (긴장축_1, default_001 등)
- ❌ **KB 검색 실패**: "[WARN] No candidates or vectorizer not initialized"

**근본 원인**:
- `kb_service.py`에서 global instance 생성하지만 `load_all_domains()` 미호출
- `main.py` 앱 시작 시 KB 초기화 로직 없음
- `available_anchors`가 빈 리스트로 전달 → Producer 가짜 앵커 생성

**해결책**:
- KB Service 모듈 import 시 자동 로드
- KB 파일 경로를 프로젝트 루트 기준으로 수정
- `available_anchors` 정상 전달 (144개)

**해결 후 (2025-11-11 22:34)**:
- ✅ **KB 로드**: **144개** 항목
- ⚠️ **anchored_by**: **45.2%** (백엔드 70.5% 대비 낮지만 개선)
- ⚠️ **가짜 앵커**: **5개** (통합지식_긴장축_1, 책_요약 등)
  - 일부는 Integrator/Producer에서 생성된 "긴장축" 관련 앵커
  - KB에 긴장축 앵커가 없어 LLM이 자체 생성

**분석**:
- KB 검색은 정상 작동 (144개 로드, vectorizer 초기화)
- Producer에서 여전히 일부 가짜 앵커 생성
- 원인: 긴장축을 설명하는 KB 앵커 부족 → LLM이 `통합지식_긴장축_1` 등 생성

---

## 🎯 개선 방향 (향후)

### 1. **가짜 앵커 완전 제거**
- Integrator에서 긴장축을 KB 앵커로만 표현하도록 프롬프트 강화
- Producer에서 `available_anchors` 리스트를 더 강하게 제약

### 2. **anchored_by 향상**
- 모든 섹션에서 앵커 사용 강제
- "통합 기록" 섹션에도 KB 앵커 포함

### 3. **LLM 모델 실험**
- gpt-4o (더 강력한 모델) 테스트
- Temperature 조정 (창의성 vs 정확성)

---

## 📊 현재 품질 수준 (Phase 3.3)

**달성**:
- ✅ 구조 완성도: **12/12 섹션**
- ✅ 고유문장: **3개** 추출
- ✅ 생성 시간: **30-40초**
- ✅ KB 로드: **144개** 항목
- ✅ 진짜 KB 앵커 사용: **18개** (23개 중)

**미달성**:
- ⚠️ anchored_by: **45%** (목표 100%)
- ⚠️ 가짜 앵커: **5개** (목표 0개)

**MVP 수용 기준**: **조건부 달성**
- 핵심 기능 모두 작동 ✅
- 품질 지표는 개선 여지 있음 ⚠️
- LLM 특성상 100% 달성은 어려움 (프롬프트 엔지니어링 한계)

---

**작성일**: 2025-11-11  
**버전**: MVP 0.1.0

